# _Flaky tests_

_Flaky tests_ sÃ£o testes que as vezes passam e outras falham, sem haver nenhuma modificaÃ§Ã£o nos testes propriamente ditos, ou mesmo no cÃ³digo da aplicaÃ§Ã£o sendo testada.

Tais testes devem ser evitados, visto que, no inÃ­cio, geram uma sensaÃ§Ã£o de que as coisas estÃ£o erradas com a aplicaÃ§Ã£o sendo testada, quando nem sempre isso Ã© verdade. Depois de um tempo o time perde a confianÃ§a nos testes, e quando eles estÃ£o acusando uma falha real, podem passar despercebidos.

Uma mÃ¡ prÃ¡tica em testes automatizados Ã© esperar por um estado intermediÃ¡rio antes de seguir adiante. Algo como esperar por um componente de _fallback_ que Ã© apresentado ao usuÃ¡rio enquanto uma chamada estÃ¡ sendo feita para uma API (por exemplo) estar visÃ­vel e depois nÃ£o estar mais.

Uma alternativa que o Cypress oferece para lidar com tal situaÃ§Ã£o, em vez de aguardar por tal estado intermediÃ¡rio, Ã© aguardar pela requisiÃ§Ã£o sendo feita retornar, para entÃ£o seguir adiante.

Confira a lista de conteÃºdos abaixo que as coisas ficarÃ£o mais claras.

## ConteÃºdos sugeridos

Antes de seguir adiante, tenho algumas recomendaÃ§Ãµes de conteÃºdos sobre o assunto pra te indicar:

- [Seriam os testes de UI flaky por natureza?](https://talkingabouttesting.com/2016/08/09/seriam-os-testes-de-ui-flaky-por-natureza/)
- [Como aguardar uma requisiÃ§Ã£o acabar antes de seguir adiante com Cypress](https://talkingabouttesting.com/2021/02/12/como-aguardar-um-requisicao-acabar-antes-de-seguir-adiante-com-cypress/)
- [Como utilizar fixtures com Cypress para isolar os testes do frontend](https://talkingabouttesting.com/2021/02/16/como-utilizar-fixtures-com-cypress-para-isolar-os-testes-do-frontend/)
- [Categoria 'Flake' no blog oficial do Cypress.io](https://cypress.io/blog/tag/flake/) (em inglÃªs)

## ExercÃ­cio

Abra o arquivo [`cypress/integration/flaky-test/sample.spec.js`](../cypress/integration/flaky-test/sample.spec.js) e em vez de verificar que o componente com o texto `Loading ...` Ã© exibido e depois nÃ£o mais, aguarde por uma requisiÃ§Ã£o do tipo `GET` para a rota `**/search**` antes de seguir adiante.

## _Extra credit 1_

Ainda no arquivo [`cypress/integration/flaky-test/sample.spec.js`](../cypress/integration/flaky-test/sample.spec.js), isole os testes da API externa com o uso de _fixtures_.

> ğŸ§™ğŸ» JÃ¡ existe uma _fixture_ criada, Ã© sÃ³ usar.

## _Extra credit 2_

Ainda no arquivo [`cypress/integration/flaky-test/sample.spec.js`](../cypress/integration/flaky-test/sample.spec.js), agora refatorado, remova as chamadas ao `cy.wait('@getStories')`, visto que o Cypress jÃ¡ espera por requisiÃ§Ãµes automaticamente! ğŸŒ²

___

Show de bola! âš½ NÃ£o temos mais testes _flaky_.

VÃ¡ para a [aula 4](./4.md) para conhecer a quarta mÃ¡ prÃ¡tica (_hardcoded assertions_), e como lidar com ela.
